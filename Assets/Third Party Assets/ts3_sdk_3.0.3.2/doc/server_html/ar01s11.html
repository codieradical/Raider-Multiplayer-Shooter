<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Channel and client manipulation</title><link rel="stylesheet" href="ts3doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"><link rel="home" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="up" href="index.html" title="TeamSpeak 3 Server SDK Developer Manual"><link rel="prev" href="ar01s10s04.html" title="Bandwidth information"><link rel="next" href="ar01s12.html" title="Events"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><img id="logo" src="images/logo.png"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Channel and client manipulation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s10s04.html"><img src="images/prev.png" alt="Prev"></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s12.html"><img src="images/next.png" alt="Next"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="s_manipulatechannels"></a>Channel and client manipulation</h2></div></div></div><p>The Server Lib offers a subset of client-side functionality to create, move and delete channels directly on the server.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="s_createchannel"></a>Creating a new channel</h3></div></div></div><p>To create a channel, first set the desired channel variables using <a class="link" href="ar01s10s02.html#setchannelvarasint"><code class="function">ts3server_setChannelVariableAsInt</code></a> and <a class="link" href="ar01s10s02.html#setchannelvarasstring"><code class="function">ts3server_setChannelVariableAsString</code></a>. Pass zero as the channel ID parameter.</p><p>Next send the request to the server by calling:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_flushChannelCreation</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelParentID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">result</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>uint64 <var class="pdparam">channelParentID</var></code>;<br><code>uint64* <var class="pdparam">result</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server on which that channel should be created.</p></li><li><p><em class="parameter"><code>channelParentID</code></em></p><p> ID of the parent channel, if the new channel is to be created as subchannel. Pass zero if the channel should be created as top-level channel.</p></li><li><p><em class="parameter"><code>result</code></em></p><p>Address of a variable that receives the ID of the newly created channel.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><p>Example code to create a channel:</p><pre class="programlisting">#define CHECK_ERROR(x) if((error = x) != ERROR_ok) { goto on_error; }

int createChannel(uint64 serverID, uint64 parentChannelID, const char* name, const char* topic,
                  const char* description, const char* password, int codec, int codecQuality,
                  int maxClients, int familyMaxClients, int order, int perm, int semiperm,
                  int default) {
  unsigned int error;
  uint64 newChannelID;

  /* Set channel data, pass 0 as channel ID */
  CHECK_ERROR(ts3server_setChannelVariableAsString(serverID, 0, CHANNEL_NAME, name));
  CHECK_ERROR(ts3server_setChannelVariableAsString(serverID, 0, CHANNEL_TOPIC, topic));
  CHECK_ERROR(ts3server_setChannelVariableAsString(serverID, 0, CHANNEL_DESCRIPTION, description));
  CHECK_ERROR(ts3server_setChannelVariableAsString(serverID, 0, CHANNEL_PASSWORD, password));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_CODEC, codec));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_CODEC_QUALITY, codecQuality));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_MAXCLIENTS, maxClients));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_MAXFAMILYCLIENTS, familyMaxClients));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_ORDER, order));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_FLAG_PERMANENT, perm));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_FLAG_SEMI_PERMANENT, semiperm));
  CHECK_ERROR(ts3server_setChannelVariableAsInt   (serverID, 0, CHANNEL_FLAG_DEFAULT, default));

  /* Flush changes to server */
  CHECK_ERROR(ts3server_flushChannelCreation(serverID, parentChannelID, &amp;newChannelID));

  printf("Created new channel with ID: %u\n", newChannelID);
  return 0;  /* Success */

on_error:
  printf("Error creating channel: %d\n", error);
  return 1;  /* Failure */
}</pre><p>After creating a channel, the event <a class="link" href="ar01s12.html#s_onchannelcreated"><code class="function">onChannelCreated</code></a> is called.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="s_deletechannel"></a>Deleting a channel</h3></div></div></div><p>A channel can be deleted by the server with
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_channelDelete</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">force</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;<br><code>int <var class="pdparam">force</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>The ID of the virtual server on which the channel should be deleted.</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>The ID of the channel to be deleted.</p></li><li><p><em class="parameter"><code>force</code></em></p><p>If 1, first move all clients inside the specified channel to the default channel and then delete the specific channel. If false, deleting a channel with joined clients will fail.</p><p>If 0, the server will refuse to a channel that is not empty.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><p>After successfully deleting a channel, the event <a class="link" href="ar01s12.html#s_onchanneldeleted"><code class="function">onChannelDeleted</code></a> is called for every deleted channel.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="s_movechannel"></a>Moving a channel</h3></div></div></div><p>To move a channel to a new parent channel, call
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_channelMove</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">channelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">newChannelParentID</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>uint64 <var class="pdparam">channelID</var></code>;<br><code>uint64 <var class="pdparam">newChannelParentID</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server on which the channel should be moved.</p></li><li><p><em class="parameter"><code>channelID</code></em></p><p>ID of the channel to be moved.</p></li><li><p><em class="parameter"><code>newChannelParentID</code></em></p><p>ID of the parent channel where the moved channel is to be inserted as child. Use <em class="parameter"><code>0</code></em> to insert as top-level channel.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><p>After the channel has been moved, the event <a class="link" href="ar01s12.html#s_onchanneledited"><code class="function">onChannelEdited</code></a> is called.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="s_moveclients"></a>Moving clients</h3></div></div></div><p>Clients can be moved server-side to another channel, in addition to the client-side functionality offered by the Client Lib. To move one or multiple clients to a new channel, call:
</p><div class="funcsynopsis"><table border="0" summary="Function synopsis" cellspacing="0" cellpadding="0" class="funcprototype-table"><tr><td><code class="funcdef">unsigned int <b class="fsfunc">ts3server_clientMove</b>(</code></td><td><var class="pdparam">serverID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">newChannelID</var>, </td><td> </td></tr><tr><td> </td><td><var class="pdparam">clientIDArray</var><code>)</code>;</td><td> </td></tr></table><div class="paramdef-list"><code>uint64 <var class="pdparam">serverID</var></code>;<br><code>uint64 <var class="pdparam">newChannelID</var></code>;<br><code>const anyID* <var class="pdparam">clientIDArray</var></code>;</div><div class="funcprototype-spacer"> </div></div><p>
</p><div class="itemizedlist"><ul type="disc"><li><p><em class="parameter"><code>serverID</code></em></p><p>ID of the virtual server on which the client should be moved.</p></li><li><p><em class="parameter"><code>newChannelID</code></em></p><p>ID of the channel in which the clients should be moved into.</p></li><li><p><em class="parameter"><code>newChannelParentID</code></em></p><p>Zero-terminated array with the IDs of the clients to be moved.</p></li></ul></div><p>Returns <em class="structfield"><code>ERROR_ok</code></em> on success, otherwise an error code as defined in <code class="filename">public_errors.h</code>.</p><p>After the channel has been moved, the event <a class="link" href="ar01s12.html#s_onclientmoved"><code class="function">onClientMoved</code></a> is called.</p><p>Example to move a single client to another channel:</p><pre class="programlisting">anyID clientIDArray[2];  /* One client plus terminating zero as end-marker */
uint64 newChannelID;
unsigned int error;

clientIDArray[0] = clientID;  /* Client to move */
clientIDArray[1] = 0;  /* End marker */

if((error = ts3server_clientMove(serverID, newChannelID, channelIDArray)) != ERROR_ok) {
    /* Handle error */
    return;
}

/* Client moved successfully */</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s10s04.html"><img src="images/prev.png" alt="Prev"></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s12.html"><img src="images/next.png" alt="Next"></a></td></tr><tr><td width="40%" align="left" valign="top">Bandwidth information </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Home"></a></td><td width="40%" align="right" valign="top"> Events</td></tr></table></div></body></html>
